{"version":3,"file":"chatbot.component.core.js","sourceRoot":"","sources":["../../../../../src/components/interactions/chatbot/chatbot.component.core.ts"],"names":[],"mappings":"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","sourcesContent":["// tslint:disable\n/*\n * Copyright 2017-2018 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"). You may not use this file except in compliance with\n * the License. A copy of the License is located at\n *\n *     http://aws.amazon.com/apache2.0/\n *\n * or in the \"license\" file accompanying this file. This file is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions\n * and limitations under the License.\n */\n// tslint:enable\n\nimport {\n\tComponent,\n\tInput,\n\tOutput,\n\tEventEmitter,\n\tOnInit,\n\tChangeDetectorRef,\n\tInject,\n} from '@angular/core';\nimport { AmplifyService } from '../../../providers/amplify.service';\nimport { chatBot } from '../../../assets/data-test-attributes';\nrequire('./aws-lex-audio.js');\n\nconst template = `\n<div class=\"amplify-interactions\">\n\t<div class=\"amplify-interactions-container\">\n\t\t<div class=\"amplify-form-container\">\n\t\t\t<div class=\"amplify-form-row\">\n\t\t\t\t<div class=\"amplify-interactions-conversation\">\n\t\t\t\t\t<div *ngFor=\"let message of messages\">\n\t\t\t\t\t\t<div class=\"amplify-interactions-input\">{{message.me}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-input-timestamp\">{{message.meSentTime}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response\">{{message.bot}}</div>\n\t\t\t\t\t\t<div class=\"amplify-interactions-response-timestamp\">{{message.botSentTime}}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"amplify-interactions-actions\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\tdata-test=\"${chatBot.messageInput}\"\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[value]=\"inputText\"\n\t\t\t\t\t(keyup.enter)=\"onSubmit(inputValue.value)\"\n\t\t\t\t\t(change)=\"onInputChange($event.target.value)\"\n\t\t\t\t\t[disabled]=\"inputDisabled\"\n\t\t\t\t\t*ngIf=\"textEnabled\">\n\t\t\t\t<input #inputValue\n\t\t\t\t\ttype='text'\n\t\t\t\t\tclass=\"amplify-form-input\"\n\t\t\t\t\tplaceholder=\"{{currentVoiceState}}\"\n\t\t\t\t\t[disabled]=\"!textEnabled\"\n\t\t\t\t\t*ngIf=\"!textEnabled\">\n\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t*ngIf=\"voiceEnabled\"\n\t\t\t\t\tng-style=\"{float: 'right'}\"\n\t\t\t\t\t(click)=\"micButtonHandler()\"\n\t\t\t\t\t[disabled]=\"micButtonDisabled\"\n\t\t\t\t>\n\t\t\t\t\t{{micText}}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t*ngIf=\"textEnabled\"\n\t\t\t\t\tng-style=\"{float: 'right'}\"\n\t\t\t\t\tclass=\"amplify-interactions-button\"\n\t\t\t\t\t[disabled]=\"inputDisabled\"\n\t\t\t\t\tng-click=\"!inputDisabled || onSubmit(inputValue.value)\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n`;\ndeclare var LexAudio: any;\n\nconst STATES = {\n\tINITIAL: { MESSAGE: 'Type your message or click  🎤', ICON: '🎤' },\n\tLISTENING: { MESSAGE: 'Listening... click 🔴 again to cancel', ICON: '🔴' },\n\tSENDING: { MESSAGE: 'Please wait...', ICON: '🔊' },\n\tSPEAKING: { MESSAGE: 'Speaking...', ICON: '...' },\n};\n\nconst defaultVoiceConfig = {\n\tsilenceDetectionConfig: {\n\t\ttime: 2000,\n\t\tamplitude: 0.2,\n\t},\n};\n\n@Component({\n\tselector: 'amplify-interactions-core',\n\ttemplate,\n})\nexport class ChatbotComponentCore implements OnInit {\n\terrorMessage: string;\n\tinputText: string = '';\n\tbotName: string;\n\tchatTitle: string;\n\tclearComplete: boolean = false;\n\tmessages: any = [];\n\tcompletions: any = {};\n\tcurrentVoiceState: string = STATES.INITIAL.MESSAGE;\n\tinputDisabled: boolean = false;\n\tmicText: string = STATES.INITIAL.ICON;\n\tvoiceConfig: any = defaultVoiceConfig;\n\tcontinueConversation: boolean = false;\n\tmicButtonDisabled: boolean = false;\n\taudioInput: any;\n\tlexResponse: any;\n\tconversationModeOn: boolean = false;\n\tref: ChangeDetectorRef;\n\tvoiceEnabled: boolean = false;\n\ttextEnabled: boolean = true;\n\taudioControl: any;\n\tprotected logger;\n\n\t@Output()\n\tcomplete: EventEmitter<string> = new EventEmitter<string>();\n\n\tconstructor(\n\t\tref: ChangeDetectorRef,\n\t\t@Inject(AmplifyService) public amplifyService: AmplifyService\n\t) {\n\t\tthis.ref = ref;\n\t\tthis.continueConversation = false;\n\t\tthis.logger = this.amplifyService.logger('ChatbotComponent');\n\t}\n\n\t@Input()\n\tset data(data: any) {\n\t\tthis.botName = data.bot;\n\t\tthis.chatTitle = data.title;\n\t\tthis.clearComplete = data.clearComplete;\n\t\tthis.conversationModeOn =\n\t\t\tdata.conversationModeOn === undefined ? false : data.conversationModeOn;\n\t\tthis.voiceEnabled =\n\t\t\tdata.voiceEnabled === undefined ? false : data.voiceEnabled;\n\t\tthis.textEnabled = data.textEnabled === undefined ? true : data.textEnabled;\n\t\tthis.voiceConfig = data.voiceConfig || this.voiceConfig;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.onComplete(this.botName, this.performOnComplete);\n\n\t\tif (!this.textEnabled && this.voiceEnabled) {\n\t\t\tthis.currentVoiceState = 'Click the mic button';\n\t\t\tSTATES.INITIAL.MESSAGE = 'Click the mic button';\n\t\t}\n\n\t\tif (!this.voiceEnabled && this.textEnabled) {\n\t\t\tthis.currentVoiceState = 'Type a message';\n\t\t\tSTATES.INITIAL.MESSAGE = 'Type a message';\n\t\t}\n\n\t\tif (this.voiceEnabled) {\n\t\t\tthis.audioControl = new LexAudio.audioControl();\n\t\t}\n\t}\n\n\t@Input()\n\tset bot(botName: string) {\n\t\tthis.botName = botName;\n\t\tthis.performOnComplete = this.performOnComplete.bind(this);\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.onComplete(botName, this.performOnComplete);\n\t}\n\n\t@Input()\n\tset title(title: string) {\n\t\tthis.chatTitle = title;\n\t}\n\n\t@Input()\n\tset clearOnComplete(clearComplete: boolean) {\n\t\tthis.clearComplete = clearComplete;\n\t}\n\n\tngOnInit() {\n\t\tif (!this.amplifyService.interactions()) {\n\t\t\tthrow new Error(\n\t\t\t\t'Interactions module not registered on AmplifyService provider'\n\t\t\t);\n\t\t}\n\t}\n\n\tperformOnComplete(evt) {\n\t\tthis.complete.emit(evt);\n\t\tif (this.clearComplete) {\n\t\t\tthis.messages = [];\n\t\t}\n\t}\n\n\tonInputChange(value: string) {\n\t\tthis.inputText = value;\n\t}\n\n\tonSubmit(e) {\n\t\tif (!this.inputText) {\n\t\t\treturn;\n\t\t}\n\t\tconst message = {\n\t\t\tme: this.inputText,\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\n\t\t\tbot: '',\n\t\t\tbotSentTime: '',\n\t\t};\n\t\tthis.amplifyService\n\t\t\t.interactions()\n\t\t\t.send(this.botName, this.inputText)\n\t\t\t.then((response: any) => {\n\t\t\t\tthis.inputText = '';\n\t\t\t\tmessage.bot = response.message;\n\t\t\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\t\t\tthis.messages.push(message);\n\t\t\t})\n\t\t\t.catch(error => this.logger.error(error));\n\t}\n\n\tonSilenceHandler = () => {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tthis.audioControl.exportWAV(blob => {\n\t\t\tthis.currentVoiceState = STATES.SENDING.MESSAGE;\n\t\t\tthis.audioInput = blob;\n\t\t\tthis.micText = STATES.SENDING.ICON;\n\t\t\tthis.micButtonDisabled = true;\n\t\t\tthis.lexResponseHandler();\n\t\t});\n\t\tthis.ref.detectChanges();\n\t};\n\n\treset() {\n\t\tthis.audioControl.clear();\n\t\tthis.inputText = '';\n\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\tthis.inputDisabled = false;\n\t\tthis.micText = STATES.INITIAL.ICON;\n\t\tthis.continueConversation = false;\n\t\tthis.micButtonDisabled = false;\n\t\tthis.ref.detectChanges();\n\t}\n\n\tonError(error) {\n\t\tthis.logger.error(error);\n\t}\n\n\tasync lexResponseHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst interactionsMessage = {\n\t\t\tcontent: this.audioInput,\n\t\t\toptions: {\n\t\t\t\tmessageType: 'voice',\n\t\t\t},\n\t\t};\n\n\t\tconst response = await this.amplifyService\n\t\t\t.interactions()\n\t\t\t.send(this.botName, interactionsMessage);\n\n\t\tthis.lexResponse = response;\n\t\tthis.currentVoiceState = STATES.SPEAKING.MESSAGE;\n\t\tthis.micText = STATES.SPEAKING.ICON;\n\t\tthis.micButtonDisabled = true;\n\n\t\tconst message = {\n\t\t\tme: this.lexResponse.inputTranscript,\n\t\t\tmeSentTime: new Date().toLocaleTimeString(),\n\t\t\tbot: '',\n\t\t\tbotSentTime: '',\n\t\t};\n\n\t\tthis.inputText = '';\n\t\tmessage.bot = this.lexResponse.message;\n\t\tmessage.botSentTime = new Date().toLocaleTimeString();\n\t\tthis.messages.push(message);\n\t\tthis.doneSpeakingHandler();\n\t\tthis.ref.detectChanges();\n\t}\n\n\tdoneSpeakingHandler() {\n\t\tif (!this.continueConversation) {\n\t\t\treturn;\n\t\t}\n\t\tif (this.lexResponse.contentType === 'audio/mpeg') {\n\t\t\tthis.audioControl.play(this.lexResponse.audioStream, () => {\n\t\t\t\tif (\n\t\t\t\t\tthis.lexResponse.dialogState === 'ReadyForFulfillment' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Fulfilled' ||\n\t\t\t\t\tthis.lexResponse.dialogState === 'Failed' ||\n\t\t\t\t\t!this.conversationModeOn\n\t\t\t\t) {\n\t\t\t\t\tthis.inputDisabled = false;\n\t\t\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.continueConversation = false;\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t} else {\n\t\t\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\t\t\tthis.micButtonDisabled = false;\n\t\t\t\t\tthis.audioControl.startRecording(\n\t\t\t\t\t\tthis.onSilenceHandler,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tthis.voiceConfig.silenceDetectionConfig\n\t\t\t\t\t);\n\t\t\t\t\tthis.ref.detectChanges();\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.inputDisabled = false;\n\t\t\tthis.currentVoiceState = STATES.INITIAL.MESSAGE;\n\t\t\tthis.micText = STATES.INITIAL.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.continueConversation = false;\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n\n\tasync micButtonHandler() {\n\t\tif (this.continueConversation) {\n\t\t\tthis.reset();\n\t\t\tthis.ref.detectChanges();\n\t\t} else {\n\t\t\tthis.inputDisabled = true;\n\t\t\tthis.continueConversation = true;\n\t\t\tthis.currentVoiceState = STATES.LISTENING.MESSAGE;\n\t\t\tthis.micText = STATES.LISTENING.ICON;\n\t\t\tthis.micButtonDisabled = false;\n\t\t\tthis.audioControl.startRecording(\n\t\t\t\tthis.onSilenceHandler,\n\t\t\t\tnull,\n\t\t\t\tthis.voiceConfig.silenceDetectionConfig\n\t\t\t);\n\t\t\tthis.ref.detectChanges();\n\t\t}\n\t}\n}\n"]}